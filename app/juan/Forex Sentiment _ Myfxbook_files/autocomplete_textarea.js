var _data={},_count=0,arrayAutocomplete=[],onPush=!1;function initAutocomplete(t,e){$(t?"#"+t:e).areacomplete({wordCount:1,mode:"inner",on:{query:function(t,e){for(var a=t.toLowerCase().split("@")[1],n=[],o=0;o<arrayAutocomplete.length;o++)0==arrayAutocomplete[o].toLowerCase().indexOf(a.toLowerCase())&&n.push(arrayAutocomplete[o]);e(n)},selected:function(t,e){return"@"+t.trim()+" "}}})}function cleanAutocompleteAll(){jQuery.each(_data,(function(){this.clone.remove(),this.list.remove()})),_data={},_count=0,arrayAutocomplete=[]}function refreshAutocompleteAndAdd(t){var e=[];jQuery.each(_data,(function(){this.clone.remove(),this.list.remove(),e.push(this.ta.id)})),_data={};for(var a=_count=0;a<e.length;a++)initAutocomplete(e[a]);initAutocomplete(t)}function refreshAutocompleteAndDelete(t){var e=[];jQuery.each(_data,(function(){this.clone.remove(),this.list.remove(),this.ta.id!=t&&e.push(this.ta.id)})),_data={};for(var a=_count=0;a<e.length;a++)initAutocomplete(e[a])}!function(t){t.fn.areacomplete=function(i){this.each((function(r,l){if("TEXTAREA"==l.nodeName){var c,d=i,u=(_data[_count]={id:"auto_"+_count,ta:l,wordCount:d.wordCount,on:d.on,clone:null,lineHeight:0,list:null,charInLines:{},mode:d.mode,chars:{"`":0,"~":0,1:0,"!":0,2:0,"@":0,3:0,"#":0,4:0,$:0,5:0,"%":0,6:0,"^":0,7:0,"&":0,8:0,"*":0,9:0,"(":0,0:0,")":0,"-":0,_:0,"=":0,"+":0,q:0,Q:0,w:0,W:0,e:0,E:0,r:0,R:0,t:0,T:0,y:0,Y:0,u:0,U:0,i:0,I:0,o:0,O:0,p:0,P:0,"[":0,"{":0,"]":0,"}":0,a:0,A:0,s:0,S:0,d:0,D:0,f:0,F:0,g:0,G:0,h:0,H:0,j:0,J:0,k:0,K:0,l:0,L:0,";":0,":":0,"'":0,'"':0,"\\":0,"|":0,z:0,Z:0,x:0,X:0,c:0,C:0,v:0,V:0,b:0,B:0,n:0,N:0,m:0,M:0,",":0,"<":0,".":0,">":0,"/":0,"?":0," ":0}},l=function(e){e=_data[e];var a=document.createElement("div"),n=t(e.ta).offset();return n.top=n.top-parseInt(t(e.ta).css("margin-top")),n.left=n.left-parseInt(t(e.ta).css("margin-left")),t(a).css({position:"absolute",top:0,left:0,"border-collapse":t(e.ta).css("border-collapse"),"border-bottom-style":t(e.ta).css("border-bottom-style"),"border-bottom-width":t(e.ta).css("border-bottom-width"),"border-left-style":t(e.ta).css("border-left-style"),"border-left-width":t(e.ta).css("border-left-width"),"border-right-style":t(e.ta).css("border-right-style"),"border-right-width":t(e.ta).css("border-right-width"),"border-spacing":t(e.ta).css("border-spacing"),"border-top-style":t(e.ta).css("border-top-style"),"border-top-width":t(e.ta).css("border-top-width"),direction:t(e.ta).css("direction"),"font-size-adjust":t(e.ta).css("font-size-adjust"),"font-size":t(e.ta).css("font-size"),"font-stretch":t(e.ta).css("font-stretch"),"font-style":t(e.ta).css("font-style"),"font-family":t(e.ta).css("font-family"),"font-variant":t(e.ta).css("font-variant"),"font-weight":t(e.ta).css("font-weight"),width:t(e.ta).css("width"),height:t(e.ta).css("height"),"letter-spacing":t(e.ta).css("letter-spacing"),"margin-bottom":t(e.ta).css("margin-bottom"),"margin-top":t(e.ta).css("margin-top"),"margin-right":t(e.ta).css("margin-right"),"margin-left":t(e.ta).css("margin-left"),"padding-bottom":t(e.ta).css("padding-bottom"),"padding-top":t(e.ta).css("padding-top"),"padding-right":t(e.ta).css("padding-right"),"padding-left":t(e.ta).css("padding-left"),"overflow-x":"hidden","line-height":t(e.ta).css("line-height"),"overflow-y":"hidden","z-index":-1e4}),e.chromeWidthFix=e.ta.clientWidth-t(e.ta).width(),e.lineHeight=t(e.ta).css("line-height"),isNaN(parseInt(e.lineHeight))&&(e.lineHeight=parseInt(t(e.ta).css("font-size"))+2),t(e.ta).parent("div").append(a),a}(_count),_data[_count].clone=l,_data[_count]);for(c in u.chars){" "==c?t(u.clone).html("<span id='test-width_"+u.id+"' style='line-block'>&nbsp;</span>"):t(u.clone).html("<span id='test-width_"+u.id+"' style='line-block'>"+c+"</span>");var h=t("#test-width_"+u.id).width();u.chars[c]=h}_data[_count].list=function(e){var a=document.createElement("ul");return a.id="autoList"+e.ta.id,t(a).addClass("auto-list scroll-primary"),document.body.appendChild(a),a}(_data[_count]);var p=_data[_count];t(p.list).delegate("li","click",(function(t){return s(this,p),t.stopPropagation(),t.preventDefault(),!1})),t(p.ta).blur((function(t){setTimeout((function(){n(p)}),400)})),t(p.ta).click((function(t){n(p)})),t(p.ta).keydown((function(e){var a,i=e.keyCode||e.which;if(i)switch(i){case 13:a=t("#setSelected"+(r=p).ta.id);var r=r.listVisible&&null!=a&&1==a.length?a.get(0):null;return r?(e.stopImmediatePropagation(),e.preventDefault(),n(p),s(r,p)):n(p),!0;case 40:case 38:return p.listVisible&&(a=p,40==(r=e).keyCode&&(o(1,a),r.stopImmediatePropagation(),r.preventDefault()),38==r.keyCode)&&(o(-1,a),r.stopImmediatePropagation(),r.preventDefault()),!0;case 27:n(p)}})),t(p.ta).keyup("keyup",(function(i){var s,r=i.keyCode||i.which;if(p.listVisible){if(40==r||38==r)return!0;if(13==r)return!1;if(27==r)return i.stopImmediatePropagation(),i.preventDefault(),!1}return onPush?!(onPush=!1):27===r||(""==(s=function(t){var e=a(t.ta),n=t.ta.value;if(" "==(n=n.substr(0,e)).charAt(n.length-1)||"\n"==n.charAt(n.length-1))return"";for(var o=[],i=0,s=n.length-1;i<t.wordCount&&0<=s&&"\n"!=n.charAt(s);)o.unshift(n.charAt(s)),s--,(" "==n.charAt(s)||s<0)&&i++;return o.join("")}(p))||"@"!=s.charAt(0)||null!=s.charAt(1)&&"@"==s.charAt(1)?(n(p),!0):void p.on.query(s,(function(i){if(i.length){t(p.clone).css("top",0);var r=p,l=s,c=i;r.listVisible||(r.listVisible=!0,h=function(n){if("outter"==n.mode)return function(e){var a=t(e.ta).offset();return{top:a.top+t(e.ta).height()+8,left:a.left}}(n);e.isChrome?t(n.clone).width(n.ta.clientWidth-n.chromeWidthFix):t(n.clone).width(n.ta.clientWidth);var o=n.ta,i=a(n.ta),s=o.value,r=s.substr(0,i),l=(i=s.substr(i,s.length),function(e,a){for(var n=[],o=t(a.clone).width(),i="",s=0,r=0,l="",c=a.chars,d=e.length,u=0;u<d;u++){var h=e.charAt(u);r+=(l+=h.replace(" ","&nbsp;"),void 0===c[h]?0:c[h])," "!=h&&"-"!=h||(s+r<o-1?(i+=l,s+=r):(n.push(i),i=l,s=r),l="",r=0),"\n"==h&&(s+r<o-1?n.push(i+l):(n.push(i),n.push(l)),l=i="",r=s=0)}return s+r<o-1?n.push(i+l):(n.push(i),n.push(l)),n}(r,n)),c=t(n.clone);c.html("");for(var d=0;d<l.length-1;d++)c.append("<div style='height:"+parseInt(n.lineHeight)+"px;'>"+l[d]+"</div>");return c.append("<span id='"+n.id+"' style='display:inline-block;'>"+l[l.length-1]+"</span>"),c.append("<span id='rest' style='max-width:'"+n.ta.clientWidth+"px'>"+i.replace(/\n/g,"<br/>")+"&nbsp;</span>"),c.get(0).scrollTop=o.scrollTop,{top:(r=(s=c.children("#"+n.id)).offset()).top+s.height(),left:r.left+s.width()}}(r),t(r.list).css({left:h.left+"px",top:h.top+"px",display:"block"})),new RegExp("("+l+")");var d,u,h=t(r.ta).width()-5,f="outter"==r.mode?h:"";t(r.list).empty();for(var g=0;g<c.length;g++){u={},"string"==typeof c[g]?d=c[g]:(d=c[g].value,u=c[g].data);var m=d.split(";"),v="",b=(null!=m[0]&&(v=m[0]),"");v=(null!=m[1]&&(b=m[1]),'<span class="username-auto">'+v+'</span>  <span class="name-auto">'+b+"</span>");0==g?(t(r.list).append(t('<li id="setSelected'+r.ta.id+'" class="auto-bg-active" name="autolist'+r.ta.id+'" count="'+g+'">').css("width",f+"px").attr({"data-value":m[0]}).html(v).data(u)),r.list.firstElementChild.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})):t(r.list).append(t('<li name="autolist'+r.ta.id+'" count="'+g+'">').css("width",f+"px").attr({"data-value":m[0]}).html(v).data(u))}s.length,t("#autoList"+p.ta.id+" li").mouseover((function(){o(1,p,this)}))}else n(p)})))})),t(p.ta).scroll((function(e){e=e.target,t(p.clone).get(0).scrollTop=e.scrollTop})),_count++}}))};var e={isChrome:t.browser.webkit};function a(t){var e,a;return document.selection?(a=document.selection.createRange().getBookmark(),(e=t.createTextRange()).moveToBookmark(a),(a=t.createTextRange()).collapse(!0),a.setEndPoint("EndToStart",e),a.text.length+e.text.length):t.selectionEnd}function n(e){e.listVisible&&(t("#autoList"+e.ta.id).hide(),e.listVisible=!1,t("#setSelected"+e.ta.id).id="")}function o(e,a,n){try{var o,s,r,l=t("#setSelected"+a.ta.id);null!=n?(s=i(l),t(n)[0].id="setSelected"+a.ta.id,t(n).attr("class","auto-bg-active")):(o=t('li[name="autolist'+a.ta.id+'"]'),r=!1,(s=0)<e&&parseInt(l[0].getAttribute("count"))+1!=o.length&&(s=0,s=i(l),1<o.length&&s++,r=!0),e<0&&0!=parseInt(l[0].getAttribute("count"))&&(s=0,s=i(l),1<o.length&&s--,r=!0),r&&(o[s].scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),o[s].id="setSelected"+a.ta.id,t(o[s]).attr("class","auto-bg-active")))}catch(e){}}function i(t){return null!=t?(t.attr("class",""),t.attr("id",""),t.attr("count")):""}function s(e,o){for(var i=t(e).attr("data-value"),s=a(o.ta),r=o.ta.value,l=0,c=(r=r.substr(0,s)).length-1;l<o.wordCount&&0<=c&&"\n"!=r.charAt(c);)(" "==r.charAt(--c)||c<0)&&l++;var d,u=o.ta.value.substr(0,c+1),h=(s=o.ta.value.substr(s,o.ta.value.length),o.ta.scrollTop);(d=o.on&&o.on.selected?o.on.selected(i,t(e).data()):d)&&(i=d),o.ta.value=u+i+s,o.ta.scrollTop=h,o.ta.selectionEnd=c+1+i.length,n(o),t(o.ta).focus(),onPush=!0}}(jQuery);